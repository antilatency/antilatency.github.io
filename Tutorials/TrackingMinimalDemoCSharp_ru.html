<!DOCTYPE html><html lang="ru" style="height: 100%;"><head><link rel="stylesheet" href="https://antilatency.github.io/22AB8747C60CF2B2C127CDD894CA39E1.css"><script src="https://antilatency.github.io/BCFDDB64BF4B8393E155E2912DBDFE42.js"></script><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes"><title>Tracking: Консольное приложение на C#</title></head><body class="TemplateRegularMaterial"><script>Behaviour.Initialize("TemplateLeftSideMenu",800,64)</script><nav class="menu LeftSideMenu" id="LeftSideMenu"><a class="Text AntilatencyLogo" href="https://antilatency.github.io/Root/Index_ru.html" title="Компания мечты" style="font-family: 'antilatency' !important;"><span style="color: #ACC435">a</span><span style="color: #000000">l</span></a><a class="Text" href="https://antilatency.github.io/Root/Index_ru.html" title="Компания мечты">Antilatency</a><a class="Text" href="https://antilatency.github.io/Terms/Antilatency_Device_Network_ru.html" title="Библиотека для комуникации с устройствами Antilatency. Позволяет находить устройства среди подключенных, отслеживать подключение новых устройств, запускать задачи на устройствах, а также обновлять прошивку.">Antilatency Device Network</a><a class="Text" href="https://antilatency.github.io/Hardware/Alt_ru.html" title="Alt это оптико-инерциальный модуль трекинга. Alt размещается на объектах отслеживания и определяет свое положение в пространстве относительно инфракрасных маркеров.             Alt поставляется в комплекте с проводным SocketUsb.">Alt</a><a class="Text" href="https://antilatency.github.io/Internal/Debug_ru.html" title="На этой странице странице некоторые примеры использования движка.">Debug</a><a class="Text" href="https://antilatency.github.io/Csml/CsmlPredefined/Diagnostics_ru.html" title="This page provide diagnostics information about website. This page is auto generated.">Diagnostics</a><a class="Text" href="https://antilatency.github.io/Software/Antilatency_Service_ru.html" title="Служебное приложение Antilatency для управления настройками трекинга и обновления устройств">Antilatency Service</a><a class="Text" href="https://antilatency.github.io/Store/PresetEditor_ru.html" title="Welcome to Antilatency store!">Store</a><a class="Text" href="https://antilatency.github.io/Sdk/Configurator_ru.html" title="На этой странице вы сможите &quot;Приготовить&quot; Sdk, выбрав платформу и добавив ингредиенты на ваш вкус">Sdk</a><a class="Text" href="https://antilatency.github.io/Api_ru.html" title="">Api</a></nav><div id="Content" class="Content"><div class="Header"><h1 class="Title">Tracking: Консольное приложение на C#</h1><div style="overflow: hidden;" class="Image"><img src="https://antilatency.github.io/Images/75ED08B3B1F8C8EBE4BD9C7B6418E31E/75ED08B3B1F8C8EBE4BD9C7B6418E31E2048.jpg"><script>Behaviour.Initialize("RoiImage",1.0,[13.62,98.0,17.3,82.3])</script></div><div class="Text">В этом уроке напишем минимальное консольное приложение на C#, которое: находит <a class="Text" href="https://antilatency.github.io/Hardware/Alt_ru.html" title="Alt это оптико-инерциальный модуль трекинга. Alt размещается на объектах отслеживания и определяет свое положение в пространстве относительно инфракрасных маркеров.             Alt поставляется в комплекте с проводным SocketUsb.">Alt</a>, создает <a class="Text no-target" href="https://antilatency.github.io/Csml/CsmlPredefined/NoTarget_ru.html" title="Этой страницы пока не существует">Environment</a>, запускает <a class="Text no-target" href="https://antilatency.github.io/Csml/CsmlPredefined/NoTarget_ru.html" title="Этой страницы пока не существует">Task</a> трекинга и выводит координаты в консоль.</div></div><div class="Section"><h2 class="Title" id="Оборудование">Оборудование<a class="Link" href="#Оборудование" title="Heading anchor"></a></h2><a class="Text" href="https://antilatency.github.io/Hardware/Alt_ru.html" title="Alt это оптико-инерциальный модуль трекинга. Alt размещается на объектах отслеживания и определяет свое положение в пространстве относительно инфракрасных маркеров.             Alt поставляется в комплекте с проводным SocketUsb.">Alt</a></div><div class="Section"><h2 class="Title" id="Код">Код<a class="Link" href="#Код" title="Heading anchor"></a></h2><a class="GitHubLink" target="_blank" href="https://github.com/antilatency/TrackingMinimalDemoCSharp/blob/1d6c92ff9553e183f91898c3108b6760f88475c1/Program.cs#L21-L212"></a><div class="csharp code"><pre>
<span class="keyword">using</span> System;
<span class="keyword">using</span> System.Threading;

<span class="keyword">using</span> Antilatency;
<span class="keyword">using</span> Antilatency.DeviceNetwork;
<span class="keyword">using</span> Antilatency.Alt.Tracking;
<span class="keyword">using</span> Antilatency.StorageClient;

<span class="keyword">class</span> Program {
    <span class="keyword">static</span> <span class="keyword">void</span> Main(<span class="keyword">string</span>[] args) {
        <span class="keyword">var</span> trackignExample = <span class="keyword">new</span> AltTrackingExample();
        <span class="keyword">while</span> (<span class="keyword">true</span>) {
            <span class="keyword">var</span> node = trackignExample.WaitForNode();
            trackignExample.RunTrackingTask(node);
        }
    }
}

<span class="keyword">class</span> AltTrackingExample {
    <span class="keyword">private</span> Antilatency.DeviceNetwork.ILibrary _adnLibrary;
    <span class="keyword">private</span> Antilatency.DeviceNetwork.INetwork _deviceNetwork;

    <span class="keyword">private</span> Antilatency.Alt.Tracking.ILibrary _altTrackingLibrary;
    <span class="keyword">private</span> Antilatency.Alt.Tracking.ITrackingCotask _trackingCotask;
    <span class="keyword">private</span> Antilatency.Alt.Tracking.IEnvironment _environment;
    <span class="keyword">private</span> Antilatency.Math.floatP3Q _placement;

    <span class="keyword">private</span> Antilatency.StorageClient.ILibrary _antilatencyStorageClientLibrary;

    <span class="keyword">public</span> AltTrackingExample() {
        <span class="comment">//Load libraries.</span>
        _adnLibrary = Antilatency.DeviceNetwork.Library.load();
        _antilatencyStorageClientLibrary = Antilatency.StorageClient.Library.load();
        _altTrackingLibrary = Antilatency.Alt.Tracking.Library.load();

        <span class="keyword">if</span> (_adnLibrary == <span class="keyword">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Failed to load AntilatencyDeviceNetwork library&quot;</span>);
        }

        <span class="keyword">if</span> (_antilatencyStorageClientLibrary == <span class="keyword">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Failed to load AntilatencyStorageClient library&quot;</span>);
        }

        <span class="keyword">if</span> (_altTrackingLibrary == <span class="keyword">null</span>) {
            <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;Failed to load AntilatencyAltTracking library&quot;</span>);
        }

        <span class="comment">//Set log verbosity level for Antilatency Device Network library.</span>
        _adnLibrary.setLogLevel(LogLevel.Info);

        Console.WriteLine(<span class="string">&quot;Antilatency Device Network version: &quot;</span> + _adnLibrary.getVersion());

        <span class="comment">//Create Antilatency Device Network.</span>
        _deviceNetwork = _adnLibrary.createNetwork(<span class="keyword">new</span>[] { <span class="keyword">new</span> UsbDeviceType { vid = UsbVendorId.Antilatency, pid = 0x0000 } });

        <span class="comment">//Read default environment code from AntilatencyService.</span>
        <span class="keyword">var</span> environmentCode = _antilatencyStorageClientLibrary.getLocalStorage().read(<span class="string">&quot;environment&quot;</span>, <span class="string">&quot;default&quot;</span>);

        <span class="comment">//Read default placement code from AntilatencyService.</span>
        <span class="keyword">var</span> placementCode = _antilatencyStorageClientLibrary.getLocalStorage().read(<span class="string">&quot;placement&quot;</span>, <span class="string">&quot;default&quot;</span>);

        <span class="comment">//Create placement using code received from storage.</span>
        _placement = <span class="keyword">new</span> Antilatency.Math.floatP3Q();
        <span class="keyword">if</span> (<span class="keyword">string</span>.IsNullOrEmpty(placementCode)) {
            Console.WriteLine(<span class="string">&quot;Failed to get placement code, using identity placement&quot;</span>);
            _placement.position.x = <span class="number">0</span>;
            _placement.position.y = <span class="number">0</span>;
            _placement.position.z = <span class="number">0</span>;

            _placement.rotation.x = <span class="number">0</span>;
            _placement.rotation.y = <span class="number">0</span>;
            _placement.rotation.z = <span class="number">0</span>;
            _placement.rotation.w = <span class="number">1</span>;
        } <span class="keyword">else</span> {
            _placement = _altTrackingLibrary.createPlacement(placementCode);
        }

        Console.WriteLine(
                <span class="keyword">string</span>.Format(<span class="string">&quot;Placement offset: {0}, {1}, {2}, rotation: {3}, {4}, {5}, {6}&quot;</span>,
                _placement.position.x, _placement.position.y, _placement.position.z,
                _placement.rotation.x, _placement.rotation.y, _placement.rotation.z, _placement.rotation.w
                )
            );

        <span class="comment">//Create environment using code received from storage.</span>
        _environment = _altTrackingLibrary.createEnvironment(environmentCode);

        <span class="comment">//Get all tracking markers from environment. For flexible environments markers position will be initialized with some default values</span>
        <span class="comment">//and then tracking will correct positions to match markers as close as possible to real positions.</span>
        <span class="keyword">var</span> markers = _environment.getMarkers();
        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; markers.Length; ++i) {
            Console.WriteLine(<span class="keyword">string</span>.Format(<span class="string">&quot;Environment marker position: ({0}, {1}, {2})&quot;</span>, markers[i].x, markers[i].y, markers[i].z));
        }
    }

    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>
    <span class="xmlDocTag">///</span><span class="xmlDocComment"> Checks if any idle tracking node exists.</span>
    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span>
    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;returns&gt;</span><span class="xmlDocComment">First idle tracking node.&lt;/returns&gt;</span>
    <span class="keyword">public</span> Antilatency.DeviceNetwork.NodeHandle WaitForNode() {
        Console.WriteLine(<span class="string">&quot;Waiting for tracking node...&quot;</span>);

        <span class="keyword">var</span> node = <span class="keyword">new</span> NodeHandle();
        <span class="keyword">var</span> networkUpdateId = 0u;
        <span class="keyword">do</span> {
            <span class="comment">//Every time any node is connected, disconnected or node status is changed, network update id is incremented.</span>
            <span class="keyword">var</span> updateId = _deviceNetwork.getUpdateId();
            <span class="keyword">if</span> (networkUpdateId != updateId) {
                networkUpdateId = updateId;

                Console.WriteLine(<span class="string">&quot;Network update id has been incremented, searching for available tracking node...&quot;</span>);

                node = GetTrackingNode();

                <span class="keyword">if</span> (node == Antilatency.DeviceNetwork.NodeHandle.Null) {
                    Console.WriteLine(<span class="string">&quot;Tracking node not found.&quot;</span>);
                }
            }
        } <span class="keyword">while</span> (node == Antilatency.DeviceNetwork.NodeHandle.Null);

        Console.WriteLine(<span class="string">&quot;Tracking node found, serial number: &quot;</span> + _deviceNetwork.nodeGetStringProperty(node, Antilatency.DeviceNetwork.Interop.Constants.HardwareSerialNumberKey));

        <span class="keyword">return</span> node;
    }

    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>
    <span class="xmlDocTag">///</span><span class="xmlDocComment"> Returns the first idle alt tracker node just for demonstration purposes.</span>
    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span>
    <span class="keyword">private</span> Antilatency.DeviceNetwork.NodeHandle GetTrackingNode() {
        <span class="keyword">var</span> result = <span class="keyword">new</span> NodeHandle();

        <span class="keyword">using</span> (<span class="keyword">var</span> trackingConstructor = _altTrackingLibrary.createTrackingCotaskConstructor()) {
            <span class="comment">//Get all nodes that support tracking task.</span>
            <span class="keyword">var</span> nodes = trackingConstructor.findSupportedNodes(_deviceNetwork);
            <span class="keyword">foreach</span> (<span class="keyword">var</span> node <span class="keyword">in</span> nodes) {
                <span class="comment">//If node status is idle (no task currently running) then we can start tracking task on this node.</span>
                <span class="keyword">if</span> (_deviceNetwork.nodeGetStatus(node) == NodeStatus.Idle) {
                    result = node;
                    <span class="keyword">break</span>;
                }
            }
            <span class="keyword">return</span> result;
        }
    }

    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>
    <span class="xmlDocTag">///</span><span class="xmlDocComment"> Start tracking task on node and print tracking data while node is connected and task has not been stopped.</span>
    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span>
    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;param name=&quot;node&quot;&gt;</span><span class="xmlDocComment">Node to start tracking on.&lt;/param&gt;</span>
    <span class="keyword">public</span> <span class="keyword">void</span> RunTrackingTask(Antilatency.DeviceNetwork.NodeHandle node) {
        <span class="comment">//Create tracking cotask (run tracking on node).</span>
        _trackingCotask = _altTrackingLibrary.createTrackingCotaskConstructor().startTask(_deviceNetwork, node, _environment);

        <span class="keyword">while</span> (!_trackingCotask.isTaskFinished()) {
            <span class="comment">//Get raw tracker state without extrapolation and placement correction</span>
            <span class="keyword">var</span> rawState = _trackingCotask.getState(Antilatency.Alt.Tracking.Constants.DefaultAngularVelocityAvgTime);
            Console.WriteLine(<span class="keyword">string</span>.Format(<span class="string">&quot;Raw tracker position: ({0}, {1}, {2})&quot;</span>, rawState.pose.position.x, rawState.pose.position.y, rawState.pose.position.z));

            <span class="comment">//Get extrapolated tracker state with placement correction</span>
            <span class="keyword">var</span> extrapolatedState = _trackingCotask.getExtrapolatedState(_placement, <span class="number">0</span>.06f);
            Console.WriteLine(<span class="keyword">string</span>.Format(<span class="string">&quot;Extrapolated tracker position: ({0}, {1}, {2})&quot;</span>, extrapolatedState.pose.position.x, extrapolatedState.pose.position.y, extrapolatedState.pose.position.z));

            <span class="comment">//Get current tracking stability stage</span>
            Console.WriteLine(<span class="string">&quot;Current tracking stage: &quot;</span> + extrapolatedState.stability.stage);

            <span class="comment">//5 FPS pose printing</span>
            Thread.Sleep(<span class="number">200</span>);
        }

        StopTracking();
    }

    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>
    <span class="xmlDocTag">///</span><span class="xmlDocComment"> Stop tracking task.</span>
    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span>
    <span class="keyword">private</span> <span class="keyword">void</span> StopTracking() {
        Antilatency.Utils.SafeDispose(<span class="keyword">ref</span> _trackingCotask);
    }

    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;summary&gt;</span>
    <span class="xmlDocTag">///</span><span class="xmlDocComment"> Cleanup at object destroy.</span>
    <span class="xmlDocTag">///</span> <span class="xmlDocTag">&lt;/summary&gt;</span>
    ~AltTrackingExample() {
        StopTracking();

        Antilatency.Utils.SafeDispose(<span class="keyword">ref</span> _altTrackingLibrary);
        Antilatency.Utils.SafeDispose(<span class="keyword">ref</span> _antilatencyStorageClientLibrary);
        Antilatency.Utils.SafeDispose(<span class="keyword">ref</span> _deviceNetwork);
        Antilatency.Utils.SafeDispose(<span class="keyword">ref</span> _adnLibrary);
    }
}

</pre></div></div></div><nav class="language-menu"><a class="Text" href="https://antilatency.github.io/Tutorials/TrackingMinimalDemoCSharp_en.html" title="В этом уроке напишем минимальное консольное приложение на C#, которое: находит Alt, создает Environment, запускает Task трекинга и выводит координаты в консоль.">English</a><a class="Text" href="https://antilatency.github.io/Tutorials/TrackingMinimalDemoCSharp_ru.html" title="В этом уроке напишем минимальное консольное приложение на C#, которое: находит Alt, создает Environment, запускает Task трекинга и выводит координаты в консоль.">Русский</a></nav><footer class="Footer"><div class="FooterContainer"><div class="Grid"><script>Behaviour.Initialize("Grid",250,[1,2,3,4])</script><div class="Section"><h2 class="Title" id="Products">Products<a class="Link" href="#Products" title="Heading anchor"></a></h2><ul class="List Unordered"><li><a class="Text" href="https://antilatency.github.io/Hardware/Alt_ru.html" title="Alt это оптико-инерциальный модуль трекинга. Alt размещается на объектах отслеживания и определяет свое положение в пространстве относительно инфракрасных маркеров.             Alt поставляется в комплекте с проводным SocketUsb.">Alt</a></li><li><a class="Text" href="https://antilatency.github.io/Hardware/Bracer_ru.html" title="Bracer - это wireless Socket для отслеживания рук пользователя, спроектированный для удобного размещения на руке. В отличие от стандартных VR-контроллеров, добавляя 6DoF отслеживание рук, Bracer оставляет руки пользователя свободными для взаимодействия с физическими предметами.">Bracer</a></li><li><a class="Text" href="https://antilatency.github.io/Hardware/ExtensionBoard_ru.html" title="Плата для удобного использования Antilatency Hardware Extension Interface">Antilatency Extension Board</a></li><li><a class="Text" href="https://antilatency.github.io/Hardware/PicoG2Socket_ru.html" title="Pico G2 Socket - это wireless Socket, спроектированный под шлем PicoG2 для трекинга шлема и приема данных от беспроводных устройств по Antilatency Radio Protocol.">Pico G2 Socket</a></li><li><a class="Text" href="https://antilatency.github.io/Hardware/SocketUsbRadio_ru.html" title="HMD Radio Socket - это wireless Socket, который поддерживает как прием данных от беспроводных устройств по Antilatency Radio Protocol, так и передачу данных трекинга при размещении на объектах отслеживания. ">HMD Radio Socket</a></li><li><a class="Text" href="https://antilatency.github.io/Hardware/Tag_ru.html" title="Tag - это wireless Socket, который можно закрепить на объекте или части тела человека для их отслеживания.              Tag сам по себе не определяет свое положение, а передает данные с Alt, вставленного в него.              С использованием Tag можно отслеживать физические предметы и кастомные контроллеры, например, макеты оружия.">Tag</a></li></ul></div><div class="Section"><h2 class="Title" id="Customer_Support">Customer Support<a class="Link" href="#Customer_Support" title="Heading anchor"></a></h2><ul class="List Unordered"><li><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">Get Started</a></li><li><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">Care Center</a></li><li><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">Downloads</a></li></ul></div><div class="Section"><h2 class="Title" id="For_Developers">For Developers<a class="Link" href="#For_Developers" title="Heading anchor"></a></h2><ul class="List Unordered"><li><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">API</a></li><li><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">Tutorials</a></li><li><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">Tools</a></li></ul></div><div class="Section"><h2 class="Title" id="Company">Company<a class="Link" href="#Company" title="Heading anchor"></a></h2><ul class="List Unordered"><li><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">About</a></li><li><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">Contact Us</a></li><li><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">Become a partner</a></li></ul></div></div><div class="Text"><a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">Personal data processing policy</a> | <a class="Text" href="https://antilatency.com/" title="https://antilatency.com/">Terms of Services</a> | Copyright © 2020, ALT LLC. info@antilatency.com</div></div></footer></body></html>